function wrapCanvasText(e,t,r,i,f){"undefined"==typeof i&&(i=0);var a=e.text.split(" "),o="";f=f||"left";var l=e.text.replace(/(\r\n|\n|\r)/gm,""),g=new fabric.Text(l,{fontFamily:e.fontFamily,fontSize:e.fontSize}).height,h=i>0?i-g:0,s=t.getContext("2d");s.font=e.fontSize+"px "+e.fontFamily;var u="",x=0;for(n=0;n<a.length;){var m=""==u,d=u+" "+a[n],w=s.measureText(d).width;if(r>w){if(""!=u&&(u+=" "),u+=a[n],h>0&&x*g>h){o=o.substr(0,o.length-3)+"...\n",u="";break}n++}else{if(m)for(var T="",b=0;b<a[n].length;++b){T+=a[n].charAt(b);var v=T+"-";if(s.measureText(v).width>=r){v=T.substr(0,T.length-2)+"-",a[n]=a[n].substr(T.length-1,a[n].length),o+=v;break}}for(;"right"==f&&s.measureText(" "+u).width<r;)u=" "+u;for(;"center"==f&&s.measureText(" "+u+" ").width<r;)u=" "+u+" ";o+=u+"\n",x++,u=""}}if(""!=u){for(;"right"==f&&s.measureText(" "+u).width<r;)u=" "+u;for(;"center"==f&&s.measureText(" "+u+" ").width<r;)u=" "+u+" ";o+=u+"\n",x++,u=""}o=o.substr(0,o.length-1);var c=new fabric.Text(o,{left:e.left,top:e.top,fill:e.fill,fontFamily:e.fontFamily,fontSize:e.fontSize,originX:e.originX,originY:e.originY,angle:e.angle});return c}