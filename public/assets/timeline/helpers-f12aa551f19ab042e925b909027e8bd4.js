function getActiveLegend(e){var t=e.filter(function(e){return 1==e.isLegend});return t[0]}function getEventById(e,t){var n=t.filter(function(t){return t.id==e});return n[0]}function wrapCanvasText(e,t,r,i,f){"undefined"==typeof i&&(i=0);var a=e.text.split(" "),o="";f=f||"left";var l=e.text.replace(/(\r\n|\n|\r)/gm,""),g=new fabric.Text(l,{fontFamily:e.fontFamily,fontSize:e.fontSize}).height,u=i>0?i-g:0,h=t.getContext("2d");h.font=e.fontSize+"px "+e.fontFamily;var s="",d=0;for(n=0;n<a.length;){var x=""==s,c=s+" "+a[n],m=h.measureText(c).width;if(r>m){if(""!=s&&(s+=" "),s+=a[n],u>0&&d*g>u){o=o.substr(0,o.length-3)+"...\n",s="";break}n++}else{if(x)for(var v="",w=0;w<a[n].length;++w){v+=a[n].charAt(w);var T=v+"-";if(h.measureText(T).width>=r){T=v.substr(0,v.length-2)+"-",a[n]=a[n].substr(v.length-1,a[n].length),o+=T;break}}for(;"right"==f&&h.measureText(" "+s).width<r;)s=" "+s;for(;"center"==f&&h.measureText(" "+s+" ").width<r;)s=" "+s+" ";o+=s+"\n",d++,s=""}}if(""!=s){for(;"right"==f&&h.measureText(" "+s).width<r;)s=" "+s;for(;"center"==f&&h.measureText(" "+s+" ").width<r;)s=" "+s+" ";o+=s+"\n",d++,s=""}o=o.substr(0,o.length-1);var b=new fabric.Text(o,{left:e.left,top:e.top,fill:e.fill,fontFamily:e.fontFamily,fontSize:e.fontSize,originX:e.originX,originY:e.originY,angle:e.angle});return b}